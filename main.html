<!DOCTYPE html>
<html>
  <head>
    <title>Nursery Scheduler</title>
    <meta charset='utf-8' />
  </head>
  <body>
    <p>Projekt Grupowy</p>

    <!--Add buttons to initiate auth sequence and sign out-->
    <button id="authorize-button" style="display: none;">Autoryzacja</button>
    <button id="signout-button" style="display: none;">Wyloguj sie</button>

    <button id="add-button" onclick="addEvents()">Dodaj</button>
    <button id="clear-button" onclick="clearEvents()">Usun wszystkie rekordy</button>

    <pre id="content"></pre>

    <script type="text/javascript">

        var D_begin = '08:00';
        var D_end = '17:00';
        var E_begin = '07:00';
        var E_end = '16:00';
        var L_begin = '14:00';
        var L_end = '23:00';
        var N_begin = '23:00';
        var N_end = '07:00';
      // Client ID and API key from the Developer Console
      var CLIENT_ID = '1047768627-vpslilg9obi5s5r87qfnsa56dmu44f0m.apps.googleusercontent.com';
      var API_KEY = 'AIzaSyB9WVA1vqVrBo_5gWsWy6ZJucdo-OL9lEY';

      // Array of API discovery doc URLs for APIs used by the quickstart
      var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];

      // Authorization scopes required by the API; multiple scopes can be
      // included, separated by spaces.
      var SCOPES = "https://www.googleapis.com/auth/calendar";

      var authorizeButton = document.getElementById('authorize-button');
      var signoutButton = document.getElementById('signout-button');

      /**
       *  On load, called to load the auth2 library and API client library.
       */
      function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }

      /**
       *  Initializes the API client library and sets up sign-in state
       *  listeners.
       */
      function initClient() {
        gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          discoveryDocs: DISCOVERY_DOCS,
          scope: SCOPES
        }).then(function () {
          // Listen for sign-in state changes.
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          // Handle the initial sign-in state.
          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
          authorizeButton.onclick = handleAuthClick;
          signoutButton.onclick = handleSignoutClick;
        });
      }

      /**
       *  Called when the signed in status changes, to update the UI
       *  appropriately. After a sign-in, the API is called.
       */
      function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          authorizeButton.style.display = 'none';
          signoutButton.style.display = 'block';
          listUpcomingEvents();
        } else {
          authorizeButton.style.display = 'block';
          signoutButton.style.display = 'none';
        }
      }

      /**
       *  Sign in the user upon button click.
       */
      function handleAuthClick(event) {
        gapi.auth2.getAuthInstance().signIn();
      }

      /**
       *  Sign out the user upon button click.
       */
      function handleSignoutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }

      /**
       * Append a pre element to the body containing the given message
       * as its text node. Used to display the results of the API call.
       *
       * @param {string} message Text to be placed in pre element.
       */
      function appendPre(message) {
        var pre = document.getElementById('content');
        var textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent);
      }

      /**
       * Print the summary and start datetime/date of the next ten events in
       * the authorized user's calendar. If no events are found an
       * appropriate message is printed.
       */
      function listUpcomingEvents() {
        gapi.client.calendar.events.list({
          'calendarId': 'mieulsd7alt7nv54npe75e9eug@group.calendar.google.com',
          'timeMin': (new Date()).toISOString(),
          'showDeleted': false,
          'singleEvents': true,
          'maxResults': 300,
          'orderBy': 'startTime'
        }).then(function(response) {
          var events = response.result.items;
          appendPre('Upcoming events:');

          if (events.length > 0) {
            for (i = 0; i < events.length; i++) {
              var event = events[i];
              var when = event.start.dateTime;
              if (!when) {
                when = event.start.date;
              }
              appendPre(event.summary + ' (' + when + ')')
            }
          } else {
            appendPre('No upcoming events found.');
          }
        });
      }

 

      function clearEvents() {
        gapi.client.calendar
      }


      function Nurse(id) {
        this.id = id;
        var isBusy = false;
        var workedToday = false;
        var consecutiveShifts = 0;
        var consecutiveNights = 0;

        Nurse.prototype.getid = function() {
          return this.id;
        };

        Nurse.prototype.setisBusy = function(isBusy) {
          this.isBusy = isBusy;
        };

        Nurse.prototype.gettisBusy = function() {
          return this.isBusy;
        };

        Nurse.prototype.setworkedToday = function(workedToday) {
          this.workedToday = workedToday;
        };

        Nurse.prototype.getworkedToday = function() {
          return this.workedToday;
        };

        Nurse.prototype.getconsecutiveShifts = function() {
          return this.consecutiveShifts;
        };

        Nurse.prototype.getconsecutiveNights = function() {
          return this.consecutiveNights;
        };

        Nurse.prototype.checkconsecutiveNights = function() {
          if(this.consecutiveNights == 3)
            return true;
        };

        Nurse.prototype.checkconsecutiveShifts = function() {
          if(this.consecutiveShifts == 6)
            return true;
        };

        Nurse.prototype.checkconsecutiveShifts = function() {
          if(this.consecutiveShifts == 6)
            return true;
        };

      }

      function Mon(){

      }
      function Tue(){

      }
      function Wed(){
        
      }
      function Thu(){
        
      }
      function Fri(){
        
      }
      function Sat(){
        
      }
      function Sun(){
        
      }

      function addEvents() {

        var l_pielegniarek = 5;
        var l_dni = 7;
        var nurse1 = new Nurse(1);
        var nurse2 = new Nurse(2);
        var nurse3 = new Nurse(3);
        var nurse4 = new Nurse(4);
        var nurse5 = new Nurse(5);


        var NursesArray = new Array();
        NursesArray.push(nurse1);
        NursesArray.push(nurse2);
        NursesArray.push(nurse3);
        NursesArray.push(nurse4);
        NursesArray.push(nurse5);



        for(i=0; i<l_dni; i++)
        {
        
          for (var j = 0; j < NursesArray.length; j++){
            if(!NursesArray[j].isBusy)
            {
              var x = i + 3;
              var event = {
                'summary': 'PielÄ™gniarka '+ j,
                'location': 'Szpital',
                'description': '//TODO',
                'start': {
                  'dateTime': '2018-04-2'+x+'T'+D_begin+':00+01:00'
                },
                'end': {
                  'dateTime': '2018-04-2'+x+'T'+D_end+':00+01:00'
                }
              };
    
        var request = gapi.client.calendar.events.insert({
        'calendarId': 'mieulsd7alt7nv54npe75e9eug@group.calendar.google.com',
        'resource': event
          });
    
        request.execute(function(event) {
        appendPre('Event created: ' + event.htmlLink);
        });
        }
      }
    }
  }

  function clearEvents()
  {
    //TODO
    var cal = CalendarApp.getCalendarById('mieulsd7alt7nv54npe75e9eug@group.calendar.google.com');
    var events = cal.getEvents(startTime, endTime);
    for ( var i in events ) {
      var id = events[i].getId();

    var params = {
      calendarId: 'mieulsd7alt7nv54npe75e9eug@group.calendar.google.com',
      eventId: id,
    };

    calendar.events.delete(params, function(err) {
      if (err) {
        console.log('The API returned an error: ' + err);
        return;
      }
      console.log('Event deleted.');
    });
  }
}


    </script>

    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
  </body>
</html>
